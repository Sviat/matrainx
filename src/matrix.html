<html>
<head>
<script src="../dependency/jquery.min.js" type="text/javascript"></script>
    <meta charset="utf-8">
    <title>Matrix Has You</title>
    <style>
        body { margin:0; padding:0; }
        #matrix { position:absolute; overflow: hidden; bottom:0; width:100%; }
    </style>
</head>
<body>
<canvas id="matrix">Sorry Browser Won't Support</canvas>

<script>
$(document).ready(function(){
var delay = 1000 / 30;
var fontSize = 14;
var s = window.screen;
var width = matrix.width = s.width;
var height = matrix.height = s.height;
var yPositions = Array(Math.round(width/(fontSize-2))).join(0).split('');
var ctx=matrix.getContext('2d');
//ctx.fillStyle='rgba(0,0,0,0.05)';
//ctx.fillRect(0,0,width,height);
ctx.font = fontSize + 'pt Monospace';

var symbolsCache = new Array(128);
var addSymbolToCache = function(element){
    symbolsCache.pop();
    symbolsCache.unshift(element);
};
function giveMeSymbol()
{
    var symbolRangeBegin = 0x00C0;
    var symbolRangeEnd = 0xDBFF;

    var code = symbolRangeBegin + Math.random() * (symbolRangeEnd - symbolRangeBegin + 1);
    if((code >= 0x1C90) && (code <= 0x1CCF))
    {
        code = 0x1699;//0x0020;
    } else 
    while( ((code >= 0x0800) && (code <= 0x08FF))
         ||((code >= 0x2100) && (code <= 0x27FF))
         ||((code >= 0x2934) && (code <= 0x2935))
         ||((code >= 0x2B00) && (code <= 0x2B59))
         ||((code >= 0x3297) && (code <= 0x3299))
         ||((code >= 0xFC00) && (code <= 0xFFFF))
         ||( code in [0x20E3, 0x303D, 0x3030, 0x2B55, 0x2B1C, 0x2B1B, 0x2B50] ) )
    {
        var tempStart = 0x13000;
        var tempEnd = 0x1342F;
        code = tempStart + Math.random() * (tempEnd - tempStart + 1);
    }
	code = Math.trunc(code);
    addSymbolToCache(code);
    return String.fromCharCode(code);
    //return String.fromCodePoint(code);
}

var start = null;
var draw = function (timestamp)
{
  if (!start) start = timestamp;
  var progress = timestamp - start;

  Game_Interval = window.requestAnimationFrame(draw);
  if( progress > delay )
  {
    start = timestamp;
    ctx.fillStyle='rgba(0,0,0,.05)';
    ctx.fillRect(0,0,width,height);
    ctx.fillStyle='#0F0';
    yPositions.map(function(y, index){
    text = giveMeSymbol();
    x = (index - 1) * (fontSize-1);
    ctx.fillText(text, x, y);
	
    //ctx.fillStyle='rgba(0,0,0,1.0)';
    //ctx.fillStyle='#000';
    //ctx.fillRect(0,0,1,1);
    //ctx.fillText(text.charCodeAt(0), x, 20);
    if(y > (yPositions.length/2) + Math.random()*1e4)
    {
        //ctx.fillStyle='rgba(127,255,127,0.5)';
        //matrix.getContext('2d').fillText(text, x, y);
        //ctx.fillStyle='#0F0';

        yPositions[index] = 0;
    }
    else
    {
        yPositions[index] = y + fontSize;
    }
    });
  }
};

function RunMatrix()
{
    if(typeof Game_Interval != "undefined")
    {
        window.cancelAnimationFrame(Game_Interval);
        Game_Interval = undefined;
        start = null;
		let tmp = "";
		for(var s in symbolsCache)
		{
			tmp += "0x"+symbolsCache[s].toString(16) + "[" + String.fromCharCode(symbolsCache[s]) + "], ";
		}
		console.log(tmp);
    } else {
        Game_Interval = window.requestAnimationFrame(draw);
    }
}

$("#matrix").click(function(){
    RunMatrix();
});

RunMatrix();
})
</script>
</body>
</html>